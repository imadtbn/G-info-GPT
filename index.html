<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø­Ø¶ÙŠØ±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù„ÙŠ â€” Ù…Ø­Ù„ÙŠ</title>
  <meta name="description" content="Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø­Ù„ÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©ØŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ C12 (ØªØ³Ù„ÙŠÙ…)ØŒ C7 (ØµÙŠØ§Ù†Ø©)ØŒ Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯/ØªØµØ¯ÙŠØ± Excel." />  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>  <style>
    body{font-family: 'Cairo', sans-serif}
    @media print{.no-print{display:none!important}}
    .badge{display:inline-block;padding:4px 8px;border-radius:8px;font-size:12px}
  </style></head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
  <div class="min-h-screen grid grid-cols-1 lg:grid-cols-[260px_1fr]">
    <aside class="bg-white dark:bg-gray-950 border-r dark:border-gray-800 p-4">
      <div class="flex items-center gap-3 mb-6">
        <div class="text-2xl">ğŸ–¥ï¸</div>
        <div class="font-bold text-lg">Ø­Ø¶ÙŠØ±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù„ÙŠ</div>
      </div>
      <nav class="space-y-2">
        <button data-tab="dashboard" class="tabBtn w-full text-right px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
        <button data-tab="devices" class="tabBtn w-full text-right px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</button>
        <button data-tab="users" class="tabBtn w-full text-right px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</button>
        <button data-tab="c12" class="tabBtn w-full text-right px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">C12 - Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
        <button data-tab="c7" class="tabBtn w-full text-right px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">C7 - Ø§Ù„ØµÙŠØ§Ù†Ø©</button>
        <div class="mt-4 border-t pt-3">
          <button id="exportAll" class="w-full text-right px-3 py-2 rounded-lg bg-green-600 text-white">ØªØµØ¯ÙŠØ± ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
          <label class="w-full block mt-2 cursor-pointer rounded-lg border px-3 py-2 text-right"><i class="fa-solid fa-upload"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù Excel
            <input id="importAll" type="file" accept=".xlsx,.xls" class="hidden" />
          </label>
          <button id="resetData" class="w-full mt-2 text-right px-3 py-2 rounded-lg border">ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</button>
        </div>
      </nav>
    </aside><main class="p-6">
  <!-- Dashboard -->
  <section id="dashboard" class="tabContent">
    <div class="flex items-center justify-between mb-4">
      <h1 class="text-2xl font-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
      <div class="text-sm text-gray-600">Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ: <span id="autoSaveStatus">Ø¬Ø§Ù‡Ø²</span></div>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <div class="p-4 bg-white rounded-lg shadow-sm dark:bg-gray-800">
        <div class="text-sm text-gray-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</div>
        <div id="statDevices" class="text-2xl font-bold">0</div>
      </div>
      <div class="p-4 bg-white rounded-lg shadow-sm dark:bg-gray-800">
        <div class="text-sm text-gray-500">Ø£Ø¬Ù‡Ø²Ø© Ù…ØªØµÙ„Ø© Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©</div>
        <div id="statOnline" class="text-2xl font-bold">0</div>
      </div>
      <div class="p-4 bg-white rounded-lg shadow-sm dark:bg-gray-800">
        <div class="text-sm text-gray-500">Ø£ÙˆØ±Ø§Ù‚ C12</div>
        <div id="statC12" class="text-2xl font-bold">0</div>
      </div>
      <div class="p-4 bg-white rounded-lg shadow-sm dark:bg-gray-800">
        <div class="text-sm text-gray-500">Ø£ÙˆØ±Ø§Ù‚ C7 (Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­)</div>
        <div id="statC7Repair" class="text-2xl font-bold">0</div>
      </div>
    </div>
    <div class="mb-6">
      <h3 class="font-bold mb-2">Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹</h3>
      <input id="globalSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…..." class="w-full rounded-lg border px-3 py-2 bg-white dark:bg-gray-800" />
    </div>
    <div>
      <h3 class="font-bold mb-2">Ø¢Ø®Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</h3>
      <ul id="recentList" class="list-disc pl-6 text-sm text-gray-700 dark:text-gray-300"></ul>
    </div>
  </section>

  <!-- Devices -->
  <section id="devices" class="tabContent hidden">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold">Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</h2>
      <button id="addDeviceBtn" class="px-4 py-2 rounded-lg bg-primary-600 text-white">Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯</button>
    </div>
    <div class="overflow-auto bg-white rounded-lg dark:bg-gray-800 p-2">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-50 dark:bg-gray-900">
          <tr>
            <th class="px-3 py-2 text-right">#</th>
            <th class="px-3 py-2 text-right">Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ø´Ø¨ÙƒØ©</th>
            <th class="px-3 py-2 text-right">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„</th>
            <th class="px-3 py-2 text-right">Ù…Ø¶Ø§Ø¯ Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª</th>
            <th class="px-3 py-2 text-right">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="devicesTbody"></tbody>
      </table>
    </div>
  </section>

  <!-- Users -->
  <section id="users" class="tabContent hidden">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
      <button id="addUserBtn" class="px-4 py-2 rounded-lg bg-primary-600 text-white">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
    </div>
    <div class="bg-white rounded-lg p-3 dark:bg-gray-800">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-50 dark:bg-gray-900">
          <tr>
            <th class="px-3 py-2 text-right">#</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ø§Ø³Ù…</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ø§Ø®ØªØµØ§Øµ</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</th>
            <th class="px-3 py-2 text-right">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="usersTbody"></tbody>
      </table>
    </div>
  </section>

  <!-- C12 -->
  <section id="c12" class="tabContent hidden">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold">ÙˆØ«Ø§Ø¦Ù‚ C12 - ØªØ³Ù„ÙŠÙ…/Ø§Ø³ØªØ±Ø¬Ø§Ø¹</h2>
      <button id="addC12Btn" class="px-4 py-2 rounded-lg bg-primary-600 text-white">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ«ÙŠÙ‚Ø© C12</button>
    </div>
    <div class="bg-white rounded-lg p-3 dark:bg-gray-800">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-50 dark:bg-gray-900">
          <tr>
            <th class="px-3 py-2 text-right">#</th>
            <th class="px-3 py-2 text-right">Ø±Ù‚Ù… Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</th>
            <th class="px-3 py-2 text-right">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ø¬Ù‡Ø©</th>
            <th class="px-3 py-2 text-right">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="c12Tbody"></tbody>
      </table>
    </div>
  </section>

  <!-- C7 -->
  <section id="c7" class="tabContent hidden">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold">ÙˆØ«Ø§Ø¦Ù‚ C7 - ØµÙŠØ§Ù†Ø©</h2>
      <button id="addC7Btn" class="px-4 py-2 rounded-lg bg-primary-600 text-white">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ±Ù‚Ø© ØµÙŠØ§Ù†Ø©</button>
    </div>
    <div class="bg-white rounded-lg p-3 dark:bg-gray-800">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-50 dark:bg-gray-900">
          <tr>
            <th class="px-3 py-2 text-right">#</th>
            <th class="px-3 py-2 text-right">Ø±Ù‚Ù… Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</th>
            <th class="px-3 py-2 text-right">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ø¹Ø·Ù„</th>
            <th class="px-3 py-2 text-right">Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th class="px-3 py-2 text-right">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="c7Tbody"></tbody>
      </table>
    </div>
  </section>

</main>

  </div>  <!-- Ù†Ù…Ø§Ø°Ø¬ Ù…Ø®ÙÙŠØ© -->  <div id="modals" class="fixed inset-0 z-50 hidden items-center justify-center p-4 bg-black/40">
    <div id="modalContent" class="bg-white dark:bg-gray-900 rounded-lg w-full max-w-2xl p-4"></div>
  </div>  <script>
    // ======= Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ† ======
    const KEYS = { DEV:'devices', USERS:'users', C12:'c12', C7:'c7', COUNTERS:'counters', RECENT:'recent' }

    // ==== Ù…Ø³Ø§Ø¹Ø¯Ø© DOM =====
    const $ = s => document.querySelector(s)
    const $$ = s => Array.from(document.querySelectorAll(s))

    // ==== ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø© =====
    function initDB(){
      if(!localStorage.getItem(KEYS.DEV)){
        localStorage.setItem(KEYS.DEV, JSON.stringify([]))
      }
      if(!localStorage.getItem(KEYS.USERS)) localStorage.setItem(KEYS.USERS, JSON.stringify([]))
      if(!localStorage.getItem(KEYS.C12)) localStorage.setItem(KEYS.C12, JSON.stringify([]))
      if(!localStorage.getItem(KEYS.C7)) localStorage.setItem(KEYS.C7, JSON.stringify([]))
      if(!localStorage.getItem(KEYS.COUNTERS)) localStorage.setItem(KEYS.COUNTERS, JSON.stringify({ dev:0, user:0, c12:0, c7:0 }))
      if(!localStorage.getItem(KEYS.RECENT)) localStorage.setItem(KEYS.RECENT, JSON.stringify([]))
    }

    function load(key){ try{return JSON.parse(localStorage.getItem(key))||[]}catch{return []} }
    function save(key, data){ localStorage.setItem(key, JSON.stringify(data)); autoSaveNotice(); }

    // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ - Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø©
    let saveTimer = null
    function autoSaveNotice(){
      $('#autoSaveStatus').textContent = 'ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ â€” ' + new Date().toLocaleTimeString()
      clearTimeout(saveTimer)
      saveTimer = setTimeout(()=>{ $('#autoSaveStatus').textContent = 'Ø¬Ø§Ù‡Ø²' }, 3000)
      pushRecent('Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§')
    }

    function pushRecent(txt){
      const recent = load(KEYS.RECENT)
      recent.unshift({t:new Date().toLocaleString(),msg:txt})
      if(recent.length>10) recent.pop()
      save(KEYS.RECENT, recent)
      renderRecent()
    }

    function renderRecent(){
      const list = load(KEYS.RECENT)
      const ul = $('#recentList'); ul.innerHTML=''
      list.forEach(it => { const li=document.createElement('li'); li.textContent = `${it.t} â€” ${it.msg}`; ul.appendChild(li) })
    }

    // ====== Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ ======
    $$('.tabBtn').forEach(btn=>btn.addEventListener('click', ()=>{
      const tab = btn.dataset.tab
      $$('.tabContent').forEach(s=>s.classList.add('hidden'))
      $(`#${tab}`).classList.remove('hidden')
      renderAll()
    }))

    // ======= Ø±Ù†Ø¯Ø± Ø¹Ø§Ù… ======
    function renderAll(){ renderStats(); renderDevices(); renderUsers(); renderC12(); renderC7(); renderRecent(); }

    function renderStats(){
      const devs = load(KEYS.DEV)
      $('#statDevices').textContent = devs.length
      $('#statOnline').textContent = devs.filter(d=>d.network && d.network.connected).length
      $('#statC12').textContent = load(KEYS.C12).length
      $('#statC7Repair').textContent = load(KEYS.C7).filter(x=>x.status==='Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­').length
    }

    // ======== Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ========
    function renderDevices(){
      const arr = load(KEYS.DEV)
      const tbody = $('#devicesTbody'); tbody.innerHTML=''
      arr.forEach((d,i)=>{
        const tr = document.createElement('tr')
        tr.className = i%2? 'bg-gray-50/50':' '
        tr.innerHTML = `
          <td class="px-3 py-2">${i+1}</td>
          <td class="px-3 py-2">${d.name}</td>
          <td class="px-3 py-2">${d.userName||''}</td>
          <td class="px-3 py-2">${d.sn}</td>
          <td class="px-3 py-2">${d.network && d.network.connected ? `<span class=\"badge bg-green-100 text-green-800\">Ù…ØªØµÙ„ (${d.network.ip||''})</span>` : `<span class=\"badge bg-red-100 text-red-800\">Ù…Ø¹Ø²ÙˆÙ„</span>`}</td>
          <td class="px-3 py-2">${d.osName||''}<br><small>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${d.osLastUpdate||''}</small></td>
          <td class="px-3 py-2">${d.avStatus||''}<br><small>${d.avScan||''}</small></td>
          <td class="px-3 py-2">
            <button data-id="${d.id}" class="editDevice px-2 py-1 rounded border">ØªØ¹Ø¯ÙŠÙ„</button>
            <button data-id="${d.id}" class="delDevice px-2 py-1 rounded border ml-2">Ø­Ø°Ù</button>
          </td>`
        tbody.appendChild(tr)
      })
      // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      $$('.editDevice').forEach(b=>b.addEventListener('click', e=>openDeviceModal(e.target.dataset.id)))
      $$('.delDevice').forEach(b=>b.addEventListener('click', e=>deleteDevice(e.target.dataset.id)))
    }

    function openDeviceModal(id){
      const dev = load(KEYS.DEV).find(x=>x.id==id) || null
      const html = renderDeviceForm(dev)
      openModal(html)
      attachDeviceFormHandlers(dev)
    }

    function renderDeviceForm(dev){
      const isNew = !dev
      const d = dev || { name:'', userId:'', userName:'', sn:'', cpu:'', monitor:'', mouse:'', keyboard:'', printer:{name:'',connected:false,ip:'',mac:''}, network:{connected:false,ip:'',mac:''}, osName:'', osLastUpdate:'', avStatus:'', avScan:'' }
      return `
        <h3 class='text-lg font-bold mb-2'>${isNew? 'Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯':'ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù‡Ø§Ø²'}</h3>
        <div class='grid grid-cols-1 gap-2'>
          <label>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²<input id='d_name' value='${escapeHtml(d.name)}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            <select id='d_user' class='w-full rounded border px-2 py-1'>
              <option value=''>-- Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù… --</option>
              ${load(KEYS.USERS).map(u=>`<option value='${u.id}' ${u.id===d.userId? 'selected':''}>${escapeHtml(u.name)}</option>`).join('')}
            </select>
          </label>
          <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ<input id='d_sn' value='${escapeHtml(d.sn)}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©<input id='d_cpu' value='${escapeHtml(d.cpu)}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ø§Ù„Ø´Ø§Ø´Ø©<input id='d_monitor' value='${escapeHtml(d.monitor)}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ø§Ù„ÙØ£Ø±Ø©<input id='d_mouse' value='${escapeHtml(d.mouse)}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­<input id='d_keyboard' value='${escapeHtml(d.keyboard)}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© - Ø§Ù„Ø§Ø³Ù…<input id='p_name' value='${escapeHtml(d.printer?.name||'')}' class='w-full rounded border px-2 py-1' /></label>
          <label class='flex gap-2 items-center'><input id='p_connected' type='checkbox' ${d.printer?.connected? 'checked':''}/> Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ù…ØªØµÙ„Ø©</label>
          <label>Ø·Ø§Ø¨Ø¹Ø© IP<input id='p_ip' value='${escapeHtml(d.printer?.ip||'')}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ø·Ø§Ø¨Ø¹Ø© MAC<input id='p_mac' value='${escapeHtml(d.printer?.mac||'')}' class='w-full rounded border px-2 py-1' /></label>
          <label class='flex gap-2 items-center'><input id='net_connected' type='checkbox' ${d.network?.connected? 'checked':''}/> Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©</label>
          <label>IP Ø§Ù„Ø¬Ù‡Ø§Ø²<input id='net_ip' value='${escapeHtml(d.network?.ip||'')}' class='w-full rounded border px-2 py-1' /></label>
          <label>MAC Ø§Ù„Ø¬Ù‡Ø§Ø²<input id='net_mac' value='${escapeHtml(d.network?.mac||'')}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„<input id='os_name' value='${escapeHtml(d.osName||'')}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ù†Ø¸Ø§Ù…<input id='os_update' type='date' value='${d.osLastUpdate||''}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ù…Ø¶Ø§Ø¯ Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª<input id='av_status' value='${escapeHtml(d.avStatus||'')}' class='w-full rounded border px-2 py-1' /></label>
          <label>Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ<input id='av_scan' value='${escapeHtml(d.avScan||'')}' class='w-full rounded border px-2 py-1' /></label>
          <div class='flex justify-end gap-2 mt-2'>
            <button id='cancelModal' class='px-3 py-1 rounded border'>Ø¥Ù„ØºØ§Ø¡</button>
            <button id='saveDevice' class='px-3 py-1 rounded bg-primary-600 text-white'>Ø­ÙØ¸</button>
          </div>
        </div>`
    }

    function attachDeviceFormHandlers(dev){
      $('#cancelModal').addEventListener('click', closeModal)
      $('#saveDevice').addEventListener('click', ()=>{
        try{
          const name = $('#d_name').value.trim()
          const sn = $('#d_sn').value.trim()
          if(!name || !sn) return alert('Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†')
          // ØªØ­Ù‚Ù‚ ØªÙƒØ±Ø§Ø± SN Ø¹Ø§Ù…
          const all = load(KEYS.DEV)
          if(!dev){ if(all.some(x=>x.sn===sn)){ alert('ÙŠÙˆØ¬Ø¯ Ø¬Ù‡Ø§Ø² Ø¨Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚.'); return } }
          const counters = load(KEYS.COUNTERS)
          if(!dev) counters.dev = (counters.dev||0)+1
          // Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙƒØ§Ø¦Ù†
          const obj = dev || { id: 'DEV-'+(counters.dev||0) }
          obj.name = name
          obj.userId = $('#d_user').value || ''
          obj.userName = ($('#d_user').selectedOptions[0]? $('#d_user').selectedOptions[0].text : '')
          obj.sn = sn
          obj.cpu = $('#d_cpu').value
          obj.monitor = $('#d_monitor').value
          obj.mouse = $('#d_mouse').value
          obj.keyboard = $('#d_keyboard').value
          obj.printer = { name: $('#p_name').value, connected: !!$('#p_connected').checked, ip: $('#p_ip').value, mac: $('#p_mac').value }
          obj.network = { connected: !!$('#net_connected').checked, ip: $('#net_ip').value, mac: $('#net_mac').value }
          obj.osName = $('#os_name').value
          obj.osLastUpdate = $('#os_update').value
          obj.avStatus = $('#av_status').value
          obj.avScan = $('#av_scan').value

          let arr = load(KEYS.DEV)
          if(dev){ arr = arr.map(x=> x.id===obj.id? obj:x) } else { arr.push(obj) }
          save(KEYS.DEV, arr)
          save(KEYS.COUNTERS, counters)
          pushRecent(dev? 'ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù‡Ø§Ø²: '+obj.name : 'Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø²: '+obj.name)
          closeModal()
          renderAll()
        }catch(err){ console.error(err); alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸') }
      })
    }

    function deleteDevice(id){ if(!confirm('Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø§Ø² Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ')) return; let arr=load(KEYS.DEV); arr = arr.filter(x=>x.id!==id); save(KEYS.DEV, arr); pushRecent('Ø­Ø°Ù Ø¬Ù‡Ø§Ø²'); renderAll() }

    // ======= Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† ======
    function renderUsers(){ const arr=load(KEYS.USERS); const tbody=$('#usersTbody'); tbody.innerHTML=''; arr.forEach((u,i)=>{ const tr=document.createElement('tr'); tr.innerHTML = `<td class='px-3 py-2'>${i+1}</td><td class='px-3 py-2'>${u.name}</td><td class='px-3 py-2'>${u.speciality||''}</td><td class='px-3 py-2'>${(u.certs||[]).map(c=>c.name+' ('+c.date+')').join('<br>')}</td><td class='px-3 py-2'><button data-id='${u.id}' class='editUser px-2 py-1 rounded border'>ØªØ¹Ø¯ÙŠÙ„</button><button data-id='${u.id}' class='delUser px-2 py-1 rounded border ml-2'>Ø­Ø°Ù</button></td>`; tbody.appendChild(tr) })
      $$('.editUser').forEach(b=>b.addEventListener('click', e=>openUserModal(e.target.dataset.id)))
      $$('.delUser').forEach(b=>b.addEventListener('click', e=>{ if(!confirm('Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ'))return; let arr=load(KEYS.USERS); arr=arr.filter(x=>x.id!==e.target.dataset.id); save(KEYS.USERS,arr); pushRecent('Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…'); renderAll() })) }

    function openUserModal(id){ const user = load(KEYS.USERS).find(x=>x.id==id)||null; const html = renderUserForm(user); openModal(html); attachUserHandlers(user) }

    function renderUserForm(user){ const isNew=!user; const u=user||{name:'',speciality:'',certs:[]}; return `
      <h3 class='text-lg font-bold mb-2'>${isNew? 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…':'ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…'}</h3>
      <label>Ø§Ù„Ø§Ø³Ù…<input id='u_name' value='${escapeHtml(u.name)}' class='w-full rounded border px-2 py-1' /></label>
      <label>Ø§Ù„Ø§Ø®ØªØµØ§Øµ<input id='u_spec' value='${escapeHtml(u.speciality||'')}' class='w-full rounded border px-2 py-1' /></label>
      <div class='mt-2'>Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª (Ø§Ø¶Ù ÙˆØ§Ø­Ø¯Ø© ØªÙ„Ùˆ Ø§Ù„Ø£Ø®Ø±Ù‰)</div>
      <div class='flex gap-2 mt-2'>
        <input id='cert_name' placeholder='Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©' class='rounded border px-2 py-1 w-2/3' />
        <input id='cert_date' type='date' class='rounded border px-2 py-1 w-1/3' />
      </div>
      <div class='mt-2 flex justify-end gap-2'>
        <button id='cancelUser' class='px-3 py-1 rounded border'>Ø¥Ù„ØºØ§Ø¡</button>
        <button id='addCert' class='px-3 py-1 rounded border'>Ø£Ø¶Ù Ø´Ù‡Ø§Ø¯Ø©</button>
        <button id='saveUser' class='px-3 py-1 rounded bg-primary-600 text-white'>Ø­ÙØ¸</button>
      </div>
      <div id='certList' class='mt-3'>${(u.certs||[]).map(c=>`<div class='text-sm'>${escapeHtml(c.name)} â€” ${c.date}</div>`).join('')}</div>` }

    function attachUserHandlers(user){ $('#cancelUser').addEventListener('click', closeModal); $('#addCert').addEventListener('click', ()=>{ const name=$('#cert_name').value.trim(); const date=$('#cert_date').value; if(!name||!date) return alert('Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©'); const list = load(KEYS.USERS); const temp = user? (user.certs||[]) : []; temp.push({name,date}); $('#certList').innerHTML = temp.map(c=>`<div class='text-sm'>${escapeHtml(c.name)} â€” ${c.date}</div>`).join(''); user? user.certs=temp : user={...user,certs:temp}; $('#cert_name').value=''; $('#cert_date').value=''; }); $('#saveUser').addEventListener('click', ()=>{ const name=$('#u_name').value.trim(); if(!name) return alert('Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨'); const arr=load(KEYS.USERS); const counters=load(KEYS.COUNTERS); if(!user){ counters.user=(counters.user||0)+1; const id='USR-'+counters.user; const obj={id,name,speciality:$('#u_spec').value,certs:[]}; arr.push(obj); save(KEYS.USERS,arr); save(KEYS.COUNTERS,counters); pushRecent('Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…: '+name); } else { const obj={...user,name,speciality:$('#u_spec').value}; const newArr=arr.map(x=> x.id===user.id? obj:x); save(KEYS.USERS,newArr); pushRecent('ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…: '+name); } closeModal(); renderAll(); }) }

    // ======= C12/C7 ======
    function renderC12(){ const arr=load(KEYS.C12); const tbody=$('#c12Tbody'); tbody.innerHTML=''; arr.forEach((r,i)=>{ const d=load(KEYS.DEV).find(x=>x.id===r.deviceId)||{}; const tr=document.createElement('tr'); tr.innerHTML=`<td class='px-3 py-2'>${i+1}</td><td class='px-3 py-2'>${r.number}</td><td class='px-3 py-2'>${r.date}</td><td class='px-3 py-2'>${d.name||r.deviceName||''}</td><td class='px-3 py-2'>${r.recipient||''}</td><td class='px-3 py-2'>${r.entity||''}</td><td class='px-3 py-2'><button data-i='${i}' class='printC12 px-2 py-1 rounded border'>Ø·Ø¨Ø§Ø¹Ø©</button><button data-i='${i}' class='delC12 px-2 py-1 rounded border ml-2'>Ø­Ø°Ù</button></td>`; tbody.appendChild(tr) })
      $$('.delC12').forEach(b=>b.addEventListener('click', e=>{ if(!confirm('Ø­Ø°Ù ÙˆØ«ÙŠÙ‚Ø©ØŸ')) return; let arr=load(KEYS.C12); arr.splice(e.target.dataset.i,1); save(KEYS.C12,arr); pushRecent('Ø­Ø°Ù C12'); renderAll(); }))
      $$('.printC12').forEach(b=>b.addEventListener('click', e=>printC12(e.target.dataset.i))) }

    function renderC7(){ const arr=load(KEYS.C7); const tbody=$('#c7Tbody'); tbody.innerHTML=''; arr.forEach((r,i)=>{ const d=load(KEYS.DEV).find(x=>x.id===r.deviceId)||{}; const tr=document.createElement('tr'); tr.innerHTML=`<td class='px-3 py-2'>${i+1}</td><td class='px-3 py-2'>${r.number}</td><td class='px-3 py-2'>${r.date}</td><td class='px-3 py-2'>${d.name||r.deviceName||''}</td><td class='px-3 py-2'>${r.issue||''}</td><td class='px-3 py-2'>${r.status||''}</td><td class='px-3 py-2'><button data-i='${i}' class='printC7 px-2 py-1 rounded border'>Ø·Ø¨Ø§Ø¹Ø©</button><button data-i='${i}' class='delC7 px-2 py-1 rounded border ml-2'>Ø­Ø°Ù</button></td>`; tbody.appendChild(tr) })
      $$('.delC7').forEach(b=>b.addEventListener('click', e=>{ if(!confirm('Ø­Ø°Ù ÙˆØ«ÙŠÙ‚Ø© ØµÙŠØ§Ù†Ø©ØŸ')) return; let arr=load(KEYS.C7); arr.splice(e.target.dataset.i,1); save(KEYS.C7,arr); pushRecent('Ø­Ø°Ù C7'); renderAll() }))
      $$('.printC7').forEach(b=>b.addEventListener('click', e=>printC7(e.target.dataset.i))) }

    function printC12(i){ const arr=load(KEYS.C12); const r=arr[i]; const d = load(KEYS.DEV).find(x=>x.id===r.deviceId)||{}; const html = buildPrintHTML('C12', r, d); const w=window.open('','_blank'); w.document.write(html); w.document.close(); w.print(); }
    function printC7(i){ const arr=load(KEYS.C7); const r=arr[i]; const d = load(KEYS.DEV).find(x=>x.id===r.deviceId)||{}; const html = buildPrintHTML('C7', r, d); const w=window.open('','_blank'); w.document.write(html); w.document.close(); w.print(); }
    function buildPrintHTML(type, rec, device){ return `<!doctype html><html lang='ar' dir='rtl'><head><meta charset='utf-8'><title>${type} ${rec.number}</title><style>body{font-family:Arial;padding:20px}table{width:100%;border-collapse:collapse}td,th{border:1px solid #444;padding:8px;text-align:right}</style></head><body><h2>Ù†Ù…ÙˆØ°Ø¬ ${type}</h2><table><tr><th>Ø±Ù‚Ù… Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©</th><td>${rec.number}</td></tr><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><td>${rec.date}</td></tr><tr><th>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²</th><td>${device.name||rec.deviceName||''}</td></tr>${type==='C7'?`<tr><th>Ø§Ù„Ø¹Ø·Ù„</th><td>${rec.issue||''}</td></tr><tr><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><td>${rec.status||''}</td></tr>`:`<tr><th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><td>${rec.recipient||''}</td></tr><tr><th>Ø§Ù„Ø¬Ù‡Ø©</th><td>${rec.entity||''}</td></tr>`}</table><p style='margin-top:20px'>ØªÙˆÙ‚ÙŠØ¹: ___________________</p></body></html>` }// ====== Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ«Ø§Ø¦Ù‚ Ø¬Ø¯ÙŠØ¯Ø© ======
$('#addDeviceBtn').addEventListener('click', ()=>{ openModal(renderDeviceForm(null)); attachDeviceFormHandlers(null) })
$('#addUserBtn').addEventListener('click', ()=>{ openModal(renderUserForm(null)); attachUserHandlers(null) })

$('#addC12Btn').addEventListener('click', ()=>{
  const devs = load(KEYS.DEV)
  if(devs.length===0) return alert('Ù„Ø§ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø³Ø¬Ù„Ø©')
  const counters = load(KEYS.COUNTERS); counters.c12=(counters.c12||0)+1; save(KEYS.COUNTERS,counters)
  const id = 'C12-'+counters.c12
  const date = new Date().toISOString().slice(0,10)
  // Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø§ÙØ°Ø© Ø¨Ø³ÙŠØ·Ø©
  const sel = prompt('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² (ID) Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ³Ù„ÙŠÙ…:')
  if(!sel) return
  const device = devs.find(d=>d.id===sel || d.sn===sel)
  const deviceName = device? device.name : sel
  const recipient = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… Ø£Ùˆ Ø§Ù„Ø¬Ù‡Ø©:')||''
  const entity = prompt('Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„ØªÙŠ Ø³Ù„Ù…Øª Ø§Ù„Ø¬Ù‡Ø§Ø²:')||''
  const rec = { number:id, date, deviceId: device? device.id : '', deviceName, recipient, entity }
  const arr = load(KEYS.C12); arr.push(rec); save(KEYS.C12,arr); pushRecent('Ø¥Ù†Ø´Ø§Ø¡ C12 '+id); renderAll()
})

$('#addC7Btn').addEventListener('click', ()=>{
  const devs = load(KEYS.DEV)
  if(devs.length===0) return alert('Ù„Ø§ Ø£Ø¬Ù‡Ø²Ø© Ù…Ø³Ø¬Ù„Ø©')
  const counters = load(KEYS.COUNTERS); counters.c7=(counters.c7||0)+1; save(KEYS.COUNTERS,counters)
  const id = 'C7-'+counters.c7
  const date = new Date().toISOString().slice(0,10)
  const sel = prompt('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² (ID) Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØµÙŠØ§Ù†Ø©:')
  if(!sel) return
  const device = devs.find(d=>d.id===sel || d.sn===sel)
  const deviceName = device? device.name : sel
  const issue = prompt('ÙˆØµÙ Ø§Ù„Ø¹Ø·Ù„ Ø§Ù„Ù…Ø­ØªÙ…Ù„:')||''
  const rec = { number:id, date, deviceId: device? device.id : '', deviceName, issue, status:'Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­' }
  const arr = load(KEYS.C7); arr.push(rec); save(KEYS.C7,arr); pushRecent('Ø¥Ù†Ø´Ø§Ø¡ C7 '+id); renderAll()
})

// ====== Export / Import Ø´Ø§Ù…Ù„ ======
$('#exportAll').addEventListener('click', ()=>{
  const wb = XLSX.utils.book_new()
  const dev = load(KEYS.DEV)
  const users = load(KEYS.USERS)
  const c12 = load(KEYS.C12)
  const c7 = load(KEYS.C7)
  XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(dev),'Devices')
  XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(users),'Users')
  XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(c12),'C12')
  XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(c7),'C7')
  XLSX.writeFile(wb, 'inventory_export.xlsx')
})

$('#importAll').addEventListener('change', (ev)=>{
  const f = ev.target.files[0]
  if(!f) return
  const reader = new FileReader()
  reader.onload = (e)=>{
    const data = new Uint8Array(e.target.result)
    const wb = XLSX.read(data,{type:'array'})
    const names = wb.SheetNames
    if(names.includes('Devices')) save(KEYS.DEV, XLSX.utils.sheet_to_json(wb.Sheets['Devices'], {defval:''}))
    if(names.includes('Users')) save(KEYS.USERS, XLSX.utils.sheet_to_json(wb.Sheets['Users'], {defval:''}))
    if(names.includes('C12')) save(KEYS.C12, XLSX.utils.sheet_to_json(wb.Sheets['C12'], {defval:''}))
    if(names.includes('C7')) save(KEYS.C7, XLSX.utils.sheet_to_json(wb.Sheets['C7'], {defval:''}))
    pushRecent('Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù Excel')
    renderAll()
    alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.')
  }
  reader.readAsArrayBuffer(f)
})

// ======= ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø© ======
$('#resetData').addEventListener('click', ()=>{ if(!confirm('Ø³ÙŠØ¤Ø¯ÙŠ Ø°Ù„Ùƒ Ù„ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ø³ÙŠØ¨Ù‚Ù‰ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ù† Ø£Ø±Ø¯Øª Ø­ÙØ¸Ù‡). Ù…ØªØ§Ø¨Ø¹Ø©ØŸ')) return; localStorage.clear(); initDB(); renderAll(); pushRecent('ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©') })

// ======= Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ======
function openModal(html){ $('#modals').classList.remove('hidden'); $('#modalContent').innerHTML = html }
function closeModal(){ $('#modals').classList.add('hidden'); $('#modalContent').innerHTML = '' }

// ======= Ù…Ø³Ø§Ø¹Ø¯Ø© Ø·Ø¨Ø§Ø¹Ø©/escape ======
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;') }

// ====== Ø¨Ø­Ø« Ø¹Ø§Ù… ======
$('#globalSearch').addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase(); if(!q){ renderAll(); return }
  // Ø¨Ø­Ø« Ù…Ø¨Ø³Ø·: Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¨Ø§Ø³Ù… Ø£Ùˆ SN Ø£Ùˆ Ù…Ø³ØªØ®Ø¯Ù…
  const devs = load(KEYS.DEV).filter(d=> (d.name||'').toLowerCase().includes(q) || (d.sn||'').toLowerCase().includes(q) || (d.userName||'').toLowerCase().includes(q))
  // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙ‚Ø· ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©
  const tbody = $('#devicesTbody'); tbody.innerHTML=''
  devs.forEach((d,i)=>{ const tr=document.createElement('tr'); tr.innerHTML = `<td class='px-3 py-2'>${i+1}</td><td class='px-3 py-2'>${d.name}</td><td class='px-3 py-2'>${d.userName||''}</td><td class='px-3 py-2'>${d.sn}</td><td class='px-3 py-2'>${d.network.connected?d.network.ip:'Ù…Ø¹Ø²ÙˆÙ„'}</td><td class='px-3 py-2'>${d.osName||''}</td><td class='px-3 py-2'>${d.avStatus||''}</td><td class='px-3 py-2'></td>`; tbody.appendChild(tr) })
})

// ====== Ø§Ù„Ø¨Ø¯Ø¡ ======
window.addEventListener('DOMContentLoaded', ()=>{ initDB(); renderAll(); })

  </script>
</body>
</html>